// Generated by CoffeeScript 1.3.3
(function() {
  var extension, extensions, fs, parser, parserFile, source, sourceFile, vm, _i, _len,
    _this = this;

  sourceFile = "" + __dirname + "/../opal/opal.js";

  parserFile = "" + __dirname + "/../opal/opal-parser.js";

  extensions = ['.opal', '.rb'];

  fs = require('fs');

  source = fs.readFileSync(sourceFile).toString();

  parser = fs.readFileSync(parserFile).toString();

  vm = require('vm');

  vm.runInThisContext(source, sourceFile);

  vm.runInThisContext(parser, parserFile);

  Opal.parse = function(ruby, filename) {
    var required, requires, _i, _len, _ref;
    parser = Opal.Opal.Parser.$new();
    source = parser.$parse(ruby, filename);
    requires = '';
    _ref = parser.requires;
    for (_i = 0, _len = _ref.length; _i < _len; _i++) {
      required = _ref[_i];
      requires += "require('" + required + "');\n";
    }
    return source = "" + requires + source;
  };

  for (_i = 0, _len = extensions.length; _i < _len; _i++) {
    extension = extensions[_i];
    require.extensions[extension] = function(module, filename) {
      var ruby;
      ruby = fs.readFileSync("" + filename).toString();
      source = Opal.parse(ruby, filename);
      return module._compile(source, filename);
    };
  }

  require('opal_node');

  require('file');

  require('dir');

}).call(this);
