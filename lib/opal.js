// Generated by CoffeeScript 1.3.3
(function() {
  var extension, extensions, fs, parser, parserFile, source, sourceFile, version, vm, _i, _len,
    _this = this;

  version = '0.3.27';

  extensions = ['.opal', '.rb'];

  fs = require('fs');

  sourceFile = "" + __dirname + "/opal-" + version + ".js";

  parserFile = "" + __dirname + "/opal-parser-" + version + ".js";

  source = fs.readFileSync(sourceFile).toString();

  parser = fs.readFileSync(parserFile).toString();

  vm = require('vm');

  vm.runInThisContext(source, sourceFile);

  vm.runInThisContext(parser, parserFile);

  Opal.parse = function(ruby, filename) {
    return Opal.Opal.Parser.$new().$parse(ruby, filename);
  };

  for (_i = 0, _len = extensions.length; _i < _len; _i++) {
    extension = extensions[_i];
    require.extensions[extension] = function(module, filename) {
      var ruby;
      ruby = fs.readFileSync("" + filename).toString();
      source = Opal.parse(ruby, filename);
      source = source.replace(/\/\/= require +(?:\.\/)?([^;]+)[\n;]/g, 'require("$1");');
      return module._compile(source, filename);
    };
  }

}).call(this);
